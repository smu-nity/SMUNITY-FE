<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1280">
    <link rel="stylesheet" href="static/css/style.css?date=0815">
    <link rel="stylesheet" href="static/css/statistics.css">
    <link rel="icon" href="static/img/favicon.ico">
    <!-- 웹 참조-->
    <script src="//code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://kit.fontawesome.com/e8a335040d.js" crossorigin="anonymous"></script>
    <script src="static/js/includeHTML.js"></script>
    <!-- 웹 폰트 참조-->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Courgette&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500&display=swap" rel="stylesheet">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-219523848-1"></script>
    <title>Smunity</title>
</head>
<body>
    <div include-html="reference/navbar.html"></div>

    <div class="gray_sec">
    <div class="container">
        <div class="big_title">교양 추천</div>
    </div>
</div>
    <div class="white_sec">
        <div class="custom_box_wrap">
            <!-- 검색창 박스 -->
            <div>
                <div class="my_box_grade">
                    <!-- 필터링 박스 -->
                    <div style="padding:2.5rem 2.5rem 0 2.5rem">
                        <!-- 구분 박스들 -->
                        <div class="filter_wrap">
                            <form method="post" id='filter_form' name='filter_form'>
                                <!-- 내부 박스 -->
                                <div class='filter_select_wrap'>
                                    <!-- 학점 박스 -->
                                    <div class='filter_select_div'>
                                        <div class='filter_select_title'>학점</div>
                                        <div class='filter_select_box'>
                                            <div class='filter_select_chk'>
                                                <label>
                                                    <input type="checkbox" name="grade[]" value="0.5" checked>
                                                    <label></label>
                                                    &nbsp;0.5 학점
                                                </label>
                                                <br>
                                                <label>
                                                    <input type="checkbox" name="grade[]" value="1" checked>
                                                    <label></label>
                                                    &nbsp;1 학점
                                                </label>
                                                <br>
                                                <label>
                                                    <input type="checkbox" name="grade[]" value="2" checked>
                                                    <label></label>
                                                    &nbsp;2 학점
                                                </label>
                                                <br>
                                                <label>
                                                    <input type="checkbox" name="grade[]" value="3" checked>
                                                    <label></label>
                                                    &nbsp;3 학점
                                                </label>

                                            </div>
                                        </div>
                                    </div>

                                    <!-- 선택영역 박스 -->
                                    <div class='filter_select_div'>
                                        <div class='filter_select_title'>선택영역</div>
                                        <div class='filter_select_box' style="width:20rem;">
                                            <div class="filter_select_chk_wrap">
                                                <div id='selection_box' class='filter_select_chk'>
                                                    <label>
                                                        <input type="checkbox" name="selection[]" value="사상과역사" checked>
                                                        <label></label>
                                                        &nbsp;사상과역사
                                                    </label>
                                                    <br>
                                                    <label>
                                                        <input type="checkbox" name="selection[]" value="사회와문화" checked>
                                                        <label></label>
                                                        &nbsp;사회와문화
                                                    </label>
                                                    <br>
                                                    <label>
                                                        <input type="checkbox" name="selection[]" value="자기계발과진로" checked>
                                                        <label></label>
                                                        &nbsp;자기계발과진로<div style="margin: -0.5rem 0 0 1.6rem; font-size: 0.9rem;">(융합과창업)</div>
                                                    </label>
                                                </div>

                                                <div class='filter_select_chk'>
                                                    <label>
                                                        <input type="checkbox" name="selection[]" value="자연과과학기술" checked>
                                                        <label></label>
                                                        &nbsp;자연과과학기술
                                                    </label>
                                                    <br>
                                                    <label>
                                                        <input type="checkbox" name="selection[]" value="세계와지구촌" checked>
                                                        <label></label>
                                                        &nbsp;세계와지구촌
                                                    </label>
                                                    <br>
                                                    <label>
                                                        <input type="checkbox" name="selection[]" value="예술과체육" checked>
                                                        <label></label>
                                                        &nbsp;예술과체육
                                                    </label>
                                                    <br>
                                                    <label>
                                                        <input type="checkbox" name="selection[]" value="기타">
                                                        <label></label>
                                                        &nbsp;기타영역
                                                    </label>

                                                </div>

                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <!-- 검색버튼-->
                                <input class='filter_btn' type="button" value="검색하기" onclick="ajax_get_data(); return false">
                            </form>
                        </div>
                        <!-- 설명 박스 -->
                        <div class="statistics_user_box" style='margin-top: 4rem;'>
                            <div class='statistics_user_sub'>
                                스뮤니티 사용자들의 교양 데이터를 사용 중입니다<br>
                                    총 인원 : <span class="satatistics_user_info">8129</span>명 <br>
                                    학과 : <span class="satatistics_user_info">43</span>개 <br>    
                            </div>
                        </div>
                        <!-- 결과 박스 -->
                        <div style="margin-top:5rem;">
                            <div class="filter_title">
                                <div>순위</div>
                            </div>
                            <hr>
                            <!-- 여기에 테이블이 채워짐-->
                            <div id='update_div'></div>
                            <br><br>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <div include-html="reference/footer.html"></div>
</body>
<script>
    includeHTML();
    function logout() {
        var back_head = confirm('✋ 정말 로그아웃 하시겠습니까? ✋');
        if (back_head) {
            location.href = '/f_logout/';
        }
    }

    ajax_get_data();

    function ajax_get_data() {

        var formData = $("#filter_form").serialize();

        let update_div = document.getElementById('update_div');
        html = "<div class='loading_wrap'><div class='circle'></div> 데이터를 불러오는 중입니다...</div>"
        update_div.innerHTML = html;

        $.ajax(
            {
                type: 'POST',
                url: '/a_statistics/',
                // 보내는 데이터
                data: formData,
                // 성공시 받는 데이터
                success: function (context) {
                    let zip_lecture_count = context['zip_lecture_count']

                    html = "<table class='grade_table' style='margin-top:0'>";
                    html += "<tr>";
                    html += "<th class='grade_table_th' style='width:12%'>학수번호</th>"
                    html += "<th class='grade_table_th' style='width:40%'>과목명</th>"
                    html += "<th class='grade_table_th' style='width:16%'>이수구분</th>"
                    html += "<th class='grade_table_th' style='width:12%'>선택영역</th>"
                    html += "<th class='grade_table_th' style='width:8%'>학점</th>"
                    html += "<th class='grade_table_th' style='width:12%; border-right :0px'>수강횟수</th>"
                    html += "</tr>";
                    for (let i = 0; i < zip_lecture_count.length; i++) {
                        lecture_info = zip_lecture_count[i][0]
                        count = zip_lecture_count[i][1]
                        html += "<tr>";
                        html += "<td class='grade_table_td'>" + lecture_info.subject_num + "</td>";
                        html += "<td class='grade_table_td'>" + lecture_info.subject_name + "</td>";
                        html += "<td class='grade_table_td'>" + lecture_info.classification + "</td>";
                        html += "<td class='grade_table_td'>" + lecture_info.selection + "</td>";
                        html += "<td class='grade_table_td'>" + lecture_info.grade + "</td>";
                        html += "<td class='grade_table_td' style='border-right :0px;'><span style='font-weight:bold; color:#17a55e;'>" +
                            count + "</span> 회</td>";
                        html += "</tr>";
                    }
                    html += "</table>";


                    update_div.innerHTML = html;
                },
                // 에러시 설정
                // error: function (err) {
                //     console.log(err)
                //     alert('데이터를 가져오는 데 에러가 발생했습니다!');
                // }
            }
        );
    }
</script>
</html>