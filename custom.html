<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1280">
    <link rel="stylesheet" href="static/css/style.css?date=0815">
    <link rel="stylesheet" href="static/css/custom.css">
    <link rel="icon" href="static/img/favicon.ico">
    <!-- ì›¹ ì°¸ì¡°-->
    <script src="//code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://kit.fontawesome.com/e8a335040d.js" crossorigin="anonymous"></script>
    <script src="static/js/includeHTML.js"></script>
    <!-- ì›¹ í°íŠ¸ ì°¸ì¡°-->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Courgette&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500&display=swap" rel="stylesheet">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-219523848-1"></script>
    <title>Please Graduate</title>
</head>
<body>
    <div include-html="reference/navbar.html"></div>
    <div class="white_sec">
        <div class="custom_box_wrap">
            <!-- ì‚¬ìš©ë²• -->
            <div>
                <div class="custom_title">How to use</div>
                <div class="custom_box">
                    <p class="container" style="font-weight: bold; font-size: 1.2rem;">ê³¼ëª© ì¶”ê°€</p>
                    <p>1. í•™ìˆ˜ë²ˆí˜¸ ì¹¸ì— í•´ë‹¹í•˜ëŠ” í•™ìˆ˜ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê³  ê²€ìƒ‰í•©ë‹ˆë‹¤.</p>
                    <p>2. í•´ë‹¹ ê³¼ëª©ì—ëŒ€í•œ ë…„ë„,ì´ìˆ˜êµ¬ë¶„ì„ ì„ íƒí•©ë‹ˆë‹¤.</p>
                    <p>3. ë³€ê²½ ë‚´ìš©ì„ í™•ì¸í•˜ê³  ì €ì¥í•˜ê¸°ë¥¼ ëˆ„ë¦…ë‹ˆë‹¤.</p>
                    <p class="container" style="font-weight: bold; font-size: 1.2rem;">ê³¼ëª© ì‚­ì œ</p>
                    <p>1. ì‚­ì œí•˜ê³  ì‹¶ì€ ê³¼ëª©ì˜ ì˜†ì— 'ì‚­ì œ'ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.</p>
                    <p>2. ë³€ê²½ ë‚´ìš©ì„ í™•ì¸í•˜ê³  ì €ì¥í•˜ê¸°ë¥¼ ëˆ„ë¦…ë‹ˆë‹¤.</p>
                    <div style="margin-top: 1.2rem;">
                        <p><span class="caution">â€» ì£¼ì˜ ë‚´ìš© â€»</span></p>
                        <p><span class="caution">â€» ì£¼ì˜ ë‚´ìš© â€»</span></p>
                    </div>
                </div>
            </div>
            <!-- ê²€ìƒ‰ -->
            <div>
                <div>
                    <div class="custom_title">í•™ìˆ˜ë²ˆí˜¸ ê²€ìƒ‰</div>
                </div>
                <div class="my_box_grade">
                    <div style="padding:2.5rem 2.5rem 0 2.5rem">
                        <div class="custom_form">
                            <span style="font-weight: bold;">í•™ìˆ˜ë²ˆí˜¸</span>
                            <input type="text" id="s_num">
                            <button class="custom_search_btn" onclick="ajax_conn()">ê²€ìƒ‰</button>
                        </div>

                        <!-- ê²€ìƒ‰ê²°ê³¼ ë°•ìŠ¤ -->
                        <div class="result_zone">
                            <div class="custom_subtitle">
                                ê²€ìƒ‰ ê²°ê³¼
                                <p
                                    style="color:rgb(199, 199, 199); font-size:0.9rem; font-weight: lighter; margin-top:0.4rem">
                                    í•™ìˆ˜ë²ˆí˜¸ë¥¼ ê²€ìƒ‰í•´ì£¼ì„¸ìš”.
                                </p>
                            </div>

                            <!-- ì—¬ê¸°ê°€ ê²€ìƒ‰ì‹œ ê²°ê³¼ë¥¼ ë„ì›Œì£¼ëŠ” div@!!!!! -->
                            <div id="result_div"></div>
                        </div>

                        <!-- ê¸°ì´ìˆ˜ê³¼ëª© ê²°ê³¼ -->
                        <div style="margin-top:5rem;">
                            <!-- -->
                            <form action='/f_add_custom/' method='post' onclick='combine()'>
                                {% csrf_token %}
                                <div class="my_box_title">
                                    <div style="width: 10%;"></div>
                                    <div>ë‚´ ê¸°ì´ìˆ˜ê³¼ëª©</div>
                                    <input type='submit' onclick='pop_modal()' class="save_btn" value='ì €ì¥í•˜ê¸°'>
                                </div>
                                <hr>
                                <table id="mytable" class="grade_table" style='margin-bottom:3rem;'>
                                    <tr>
                                        <th class="grade_table_th" style="width:9%">ë…„ë„</th>
                                        <th class="grade_table_th" style="width:9%">í•™ê¸°</th>
                                        <th class="grade_table_th" style="width:9%">í•™ìˆ˜ë²ˆí˜¸</th>
                                        <th class="grade_table_th" style="width:36%">ê³¼ëª©ëª…</th>
                                        <th class="grade_table_th" style="width:9%">ì´ìˆ˜êµ¬ë¶„</th>
                                        <th class="grade_table_th" style="width:14%">ì„ íƒì˜ì—­</th>
                                        <th class="grade_table_th" style="width:6%;">í•™ì </th>
                                        <th class="grade_table_th" style="width:6%; border-right :0px"></th>
                                    </tr>

                                    <!-- ì»¤ìŠ¤í…€ ê³¼ëª© ë¨¼ì € ë„ìš°ê¸° -->
                                    {% for cg in custom_grade %}
                                    <tr style='color : #1ac06d'>
                                        <td class="grade_table_td">{{ cg.year }}</td>
                                        <td class="grade_table_td">{{ cg.semester }}</td>
                                        <td class="grade_table_td">{{ cg.subject_num }}</td>
                                        <td class="grade_table_td">{{ cg.subject_name }}</td>
                                        <td class="grade_table_td">{{ cg.classification }}</td>
                                        <td class="grade_table_td">{{ cg.selection }}</td>
                                        <td class="grade_table_td">{{ cg.grade | floatformat }}</td>
                                        <td class="grade_table_td" style="border-right :0px">
                                            <button class='del_btn' onclick='del_row_old(this)'>ì‚­ì œ</button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                    {% for g in grade %}
                                    <tr>
                                        <td class="grade_table_td">{{ g.year }}</td>
                                        <td class="grade_table_td">{{ g.semester }}</td>
                                        <td class="grade_table_td">{{ g.subject_num }}</td>
                                        <td class="grade_table_td">{{ g.subject_name }}</td>
                                        <td class="grade_table_td">{{ g.classification }}</td>
                                        <td class="grade_table_td">{{ g.selection }}</td>
                                        <td class="grade_table_td">{{ g.grade | floatformat }}</td>
                                        <td class="grade_table_td" style="border-right :0px"></td>
                                    </tr>
                                    {% endfor %}
                                </table>
                                <!-- ì¶”ê°€ëœ ê³¼ëª©ì •ë³´ + ì‚­ì œëœ ê³¼ëª© ì •ë³´ë¥¼ ë¬¶ì–´ì„œ ë³´ë‚´ì£¼ëŠ” ìˆ¨ê²¨ì§„ input-->
                                <input type='hidden' id='id_year' name='arr_year' value=''>
                                <input type='hidden' id='id_semester' name='arr_semester' value=''>
                                <input type='hidden' id='id_subject_num' name='arr_subject_num' value=''>
                                <input type='hidden' id='id_subject_name' name='arr_subject_name' value=''>
                                <input type='hidden' id='id_classification' name='arr_classification' value=''>
                                <input type='hidden' id='id_selection' name='arr_selection' value=''>
                                <input type='hidden' id='id_grade' name='arr_grade' value=''>
                                <input type='hidden' id='id_delete' name='arr_delete' value=''>
                            </form>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>
    </div>


    <div id='load_madal' class="modal">
        <div class="load-modal-content">
            <div class="modal_loadcontainer">
                <div class="sk-chase">
                    <div class="sk-chase-dot"></div>
                    <div class="sk-chase-dot"></div>
                    <div class="sk-chase-dot"></div>
                    <div class="sk-chase-dot"></div>
                    <div class="sk-chase-dot"></div>
                    <div class="sk-chase-dot"></div>
                </div>
                <div class="loading">
                    <span>ì •</span>
                    <span>ë³´</span>
                    <span>ì—…</span>
                    <span>ë°</span>
                    <span>ì´</span>
                    <span>íŠ¸</span>
                    <span>ì¤‘</span>
                    <span>.</span>
                    <span>.</span>
                    <span>.</span>
                </div>
                <div class="load_info">
                    ì°½ì„ ì´ë™í•˜ì§€ ë§ˆì„¸ìš”!
                </div>
            </div>
        </div>
    </div>

    <div include-html="reference/footer.html"></div>
</body>
<script>
    includeHTML();
    function logout() {
        var back_head = confirm('âœ‹ ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ? âœ‹');
        if (back_head) {
            location.href = '/f_logout/';
        }
    }

    // í•™ë²ˆì¶”ì¶œ
    const user_id = '{{request.session.id }}';
    const year = Number(user_id.substring(0, 2));

    // ì €ì¥í•˜ê¸° í´ë¦­ì‹œ ë¡œë”©ëª¨ë‹¬
    function pop_modal() {
        document.getElementById('load_madal').style.display = "block";
    }

    // ì»¤ìŠ¤í…€ í˜ì´ì§€ì—ì„œì˜ ê³¼ëª© ì¶”ê°€/ì‚­ì œ í˜„í™©ì„ ì €ì¥í•˜ëŠ” í•™ìˆ˜ë²ˆí˜¸ ë°°ì—´
    var list_delete = []

    function ajax_conn() {
        var input_s_num = $("#s_num").val();
        // ì˜ì–´ê³¼ëª© ì´ìˆ˜ë©´ì œ ì»¤ë§¨ë“œ ì…ë ¥ì‹œ
        if(input_s_num == 'ë©´ì œ'){
            if(year <= 21){
                show_table(['10352', 'English Listening Practice 1', '', 'ì´ìˆ˜ë©´ì œìš©', 0]);
                var classification_input = document.getElementById('classification');
                classification_input.value = 'êµí•„';
                classification_input.disabled = true;
                return;
            }
            else{
                show_table(['11304', 'ëŒ€í•™ì˜ì–´', '', 'ì´ìˆ˜ë©´ì œìš©', 0]);
                var classification_input = document.getElementById('classification');
                classification_input.value = 'ê³µí•„';
                classification_input.disabled = true;
                return;
            }
        }
        // ajax í†µì‹  ì‹œì‘
        $.ajax(
            {
                type: 'POST',
                url: '/a_search/',
                // viewsì—ëŠ” back_s_num ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ inputì— ìˆëŠ” í•™ìˆ˜ë²ˆí˜¸ë¥¼ ë„˜ê²¨ì¤€ë‹¤.
                data: { back_s_num: input_s_num },
                dataType: 'json',
                // ì„±ê³µì‹œ ë°±ì—ì„œ result ë³€ìˆ˜ê°€ ë„˜ì–´ì˜¨ë‹¤.
                success: function (context) {
                    if (context['result'] === 'ê²€ìƒ‰ì‹¤íŒ¨') {
                        show_fail();
                    }
                    else {
                        show_table(context['result']);
                    }
                },
                // ì—ëŸ¬ì‹œ ì„¤ì •
                error: function (e) { }
            }
        );
    }

    function show_fail() {
        var div = document.querySelector('#result_div');
        html = "<div class='caution_div'>í•´ë‹¹ í•™ìˆ˜ë²ˆí˜¸ê°€ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê²€ìƒ‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>"
        div.innerHTML = html;
    }

    function show_table(result) {
        var div = document.querySelector('#result_div');
        html = "<table class='grade_table' style='margin-top:0'>";

        html += "<tr>";
        html += "<th class='grade_table_th' style='width:10%'>ë…„ë„</th>"
        html += "<th class='grade_table_th' style='width:10%'>í•™ê¸°</th>"
        html += "<th class='grade_table_th' style='width:10%'>í•™ìˆ˜ë²ˆí˜¸</th>"
        html += "<th class='grade_table_th' style='width:40%'>ê³¼ëª©ëª…</th>"
        html += "<th class='grade_table_th' style='width:10%'>ì´ìˆ˜êµ¬ë¶„</th>"
        html += "<th class='grade_table_th' style='width:14%'>ì„ íƒì˜ì—­</th>"
        html += "<th class='grade_table_th' style='width:6%; border-right :0px'>í•™ì </th>"
        html += "</tr>";

        html += "<tr>";
        html += "<td class='grade_table_td'><input class='td_input' type='text' id='year' value='ì»¤ìŠ¤í…€' readonly></td>";
        html += "<td class='grade_table_td'><input class='td_input' type='text' id='semester' value='ì»¤ìŠ¤í…€' readonly></td>";
        html += "<td class='grade_table_td'><input class='td_input' type='text' id='subject_num' value='" + result[0] + "' readonly></td>";
        html += "<td class='grade_table_td'><input class='td_input' type='text' id='subject_name' value='" + result[1] + "' readonly></td>";
        html += "<td class='grade_table_td'>";
        html += "<select id='classification' class='td_input'>";
        html += "<option value='x' selected>-- ì„ íƒ --</option>"
        html += "<option value='ì „í•„'>ì „í•„</option>"
        html += "<option value='ì „ì„ '>ì „ì„ </option>"
        html += "<option value='êµí•„'>êµí•„</option>"
        html += "<option value='êµì„ 1'>êµì„ 1</option>"
        html += "<option value='êµì„ 2'>êµì„ 2</option>"
        html += "<option value='ê¸°êµ'>ê¸°êµ</option>"
        html += "<option value='ì—°í•„'>ì—°í•„</option>"
        html += "<option value='ì—°ì„ '>ì—°ì„ </option>"
        html += "<option value='ë³µí•„'>ë³µí•„</option>"
        html += "<option value='ë³µì„ '>ë³µì„ </option>"
        html += "<option value='êµì„ '>êµì„ (22í•™ë²ˆ ì´í›„)</option>"
        html += "<option value='ê³µí•„'>ê³µí•„</option>"
        html += "<option value='ê· í•„'>ê· í•„</option>"
        html += "<option value='ê¸°í•„'>ê¸°í•„</option>"
        html += "</select>";
        html += "</td>";
        html += "<td class='grade_table_td'><input class='td_input' type='text' id='selection' value='" + result[3] + "' readonly></td>";
        html += "<td class='grade_table_td' style='border-right :0px'><input class='td_input' type='text' id='grade' value='" + result[4] + "' readonly></td>";
        html += "</tr>";

        html += "</table>";
        html += "<button class='add_btn' onclick='add_subject()'>ê³¼ëª© ì¶”ê°€í•˜ê¸°</button>";
        div.innerHTML = html;
    }

    function add_subject() {
        // ë§Œì•½ ì„ íƒì˜ì—­ ì„ íƒì•ˆí–ˆìœ¼ë©´ ë¹ ê¾¸
        var ts_box = document.getElementById('classification');
        var ts_ind = document.getElementById("classification").options.selectedIndex;
        if (ts_box.options[ts_ind].value === "x") {
            return alert('ğŸ¤¯ ìì‹ ì—ê²Œ ë§ëŠ” ì´ìˆ˜êµ¬ë¶„ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
        }

        // 0. ìš°ì„  ê²€ìƒ‰ê²°ê³¼ í…Œì´ë¸”ì—ì„œ ê°’ì„ ë‹¤ ê¸ì–´ì˜¨ë‹¤.
        var year = document.getElementById('year').value;
        var semester = document.getElementById('semester').value;
        var subject_num = document.getElementById('subject_num').value;
        var subject_name = document.getElementById('subject_name').value;
        var classification = document.getElementById('classification').value;
        var selection = document.getElementById('selection').value;
        var grade = document.getElementById('grade').value;
        //  ë§Œì•½ ê¸°ì´ìˆ˜ê³¼ëª©í‘œì— ìˆëŠ” í•™ìˆ˜ë²ˆí˜¸ë¥¼ ì¶”ê°€í•˜ë ¤ í•œë‹¤ë©´?
        var now_s_num_list = []
        $('#mytable tr').each(
            function(){
                var inner_s_num = $(this).find('td').eq(2).text();
                if(inner_s_num === ""){
                    inner_s_num = $(this).find('td').eq(2).find('*').val();
                }
                now_s_num_list.push(inner_s_num)
            }
        );
        if(now_s_num_list.includes(subject_num)){
            // ì „ì²´ ë¦¬ìŠ¤íŠ¸ì— ë“¤ì–´ìˆìœ¼ë©´
            return alert('ğŸ¥µ ì´ë¯¸ ê¸°ì´ìˆ˜ê³¼ëª©í‘œì— í•´ë‹¹ í•™ìˆ˜ë²ˆí˜¸ê°€ ì¡´ì¬í•©ë‹ˆë‹¤!');
        }
        // 1. í–‰ìƒì„±
        var table = document.getElementById('mytable');
        var newRow = table.insertRow(1);
        // 2. í–‰ì— ê°ê° ì…€ ìƒì„±
        var newCell0 = newRow.insertCell(0);  // ë…„ë„
        var newCell1 = newRow.insertCell(1);  // í•™ê¸°
        var newCell2 = newRow.insertCell(2);  // í•™ìˆ˜ë²ˆí˜¸
        var newCell3 = newRow.insertCell(3);  // ê³¼ëª©ëª…
        var newCell4 = newRow.insertCell(4);  // ì´ìˆ˜êµ¬ë¶„
        var newCell5 = newRow.insertCell(5);  // ì„ íƒì˜ì—­
        var newCell6 = newRow.insertCell(6);  // í•™ì 
        var newCell7 = newRow.insertCell(7);  // ì‚­ì œë²„íŠ¼
        // 3. ê°ê°ì˜ ì…€ì— í´ë˜ìŠ¤ì§€ì •
        newCell0.className = 'new_td';
        newCell1.className = 'new_td';
        newCell2.className = 'new_td';
        newCell3.className = 'new_td';
        newCell4.className = 'new_td';
        newCell5.className = 'new_td';
        newCell6.className = 'new_td';
        newCell7.className = 'new_td';
        // 4. ì…€ì— ê°’ ì¶”ê°€
        newCell0.innerHTML = "<input class='new_td_input' type='text' name='year' value='" + year + "' readonly>";
        newCell1.innerHTML = "<input class='new_td_input' type='text' name='semester' value='" + semester + "' readonly>";
        newCell2.innerHTML = "<input class='new_td_input' type='text' name='subject_num' value='" + subject_num + "' readonly>";
        newCell3.innerHTML = "<input class='new_td_input' type='text' name='subject_name' value='" + subject_name + "' readonly>";
        newCell4.innerHTML = "<input class='new_td_input' type='text' name='classification' value='" + classification + "' readonly>";
        newCell5.innerHTML = "<input class='new_td_input' type='text' name='selection' value='" + selection + "' readonly>";
        newCell6.innerHTML = "<input class='new_td_input' type='text' name='grade' value='" + grade + "' readonly>";
        newCell7.innerHTML = "<button class='del_btn' onclick='del_row_new(this)'>ì‚­ì œ</button>";
        // ê²€ìƒ‰ ê²°ê³¼ì°½ì€ ì§€ì›Œì¤€ë‹¤.
        var s_num = document.querySelector('#s_num');
        s_num.value = '';
        var result_div = document.querySelector('#result_div');
        result_div.innerHTML = "";
    }

    function del_row_new(obj) {
        // í…Œì´ë¸” ë¶ˆëŸ¬ì˜¤ê¸°
        var table = document.getElementById('mytable');
        // td -> tr -> í–‰ì¸ë±ìŠ¤ ì°¾ê¸°
        var index = $(obj).parent().parent().index();
        // í…Œì´ë¸”ì—ì„œ í•´ë‹¹ ì¸ë±ìŠ¤ ì‚­ì œ
        table.deleteRow(index);
    }

    function del_row_old(obj) {
        // del_s_num ì „ì—­ë°°ì—´ì— ì‚­ì œí•œ ê¸°ì¡´ ì»¤ìŠ¤í…€ì˜ í•™ìˆ˜ë²ˆí˜¸ë¥¼ ì¶”ê°€
        var tr = $(obj).parent().parent()
        var td = tr.children()
        var s_num = td.eq(2).text()
        list_delete.push(s_num);
        // í”„ë¡ íŠ¸ í…Œì´ë¸”ì—ì„œ ì‚­ì œ
        var table = document.getElementById('mytable');
        var index = $(obj).parent().parent().index();
        table.deleteRow(index);
    }

    function combine(){
        // ê°ê° ë¹ˆ ë¦¬ìŠ¤íŠ¸ ìƒì„±
        var list_year = [];
        var list_semester = [];
        var list_subject_num = [];
        var list_subject_name = [];
        var list_classification = [];
        var list_selection = [];
        var list_grade = [];
        // ê°ê° ì¹¼ëŸ¼ë³„ nameìœ¼ë¡œ ëª¨ë‘ ë¶ˆëŸ¬ì™€ì„œ ë¦¬ìŠ¤íŠ¸ì—ë‹¤ê°€ ì €ì¥
        $('input[name=year]').each(function(index, item){
            list_year.push($(item).val());
        });
        $('input[name=semester]').each(function(index, item){
            list_semester.push($(item).val());
        });
        $('input[name=subject_num]').each(function(index, item){
            list_subject_num.push($(item).val());
        });
        $('input[name=subject_name]').each(function(index, item){
            list_subject_name.push($(item).val());
        });
        $('input[name=classification]').each(function(index, item){
            list_classification.push($(item).val());
        });
        $('input[name=selection]').each(function(index, item){
            list_selection.push($(item).val());
        });
        $('input[name=grade]').each(function(index, item){
            list_grade.push($(item).val());
        });
        // ë¦¬ìŠ¤íŠ¸ë¥¼ hidden inputìœ¼ë¡œ ë„£ì€ í›„ submit
        $('#id_year').val(list_year);
        $('#id_semester').val(list_semester);
        $('#id_subject_num').val(list_subject_num);
        $('#id_subject_name').val(list_subject_name);
        $('#id_classification').val(list_classification);
        $('#id_selection').val(list_selection);
        $('#id_grade').val(list_grade);
        // ì´ê±´ ê¸°ì¡´ ì»¤ìŠ¤í…€ì—ì„œ ì‚­ì œí•œ í•™ìˆ˜ë²ˆí˜¸ ë¦¬ìŠ¤íŠ¸
        $('#id_delete').val(list_delete);
    }
</script>
</html>